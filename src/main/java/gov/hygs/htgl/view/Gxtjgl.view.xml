<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig>
  <Arguments/>
  <Context/>
  <Model>
    <DataType name="deptType">
      <Property name="creationType">gov.hygs.htgl.entity.Dept</Property>
      <PropertyDef name="id_">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="dept_name">
        <Property></Property>
        <Property name="label">部门名称</Property>
      </PropertyDef>
      <PropertyDef name="parentId">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="ms">
        <Property></Property>
      </PropertyDef>
      <Reference name="dept">
        <Property name="dataType">[SELF]</Property>
        <Property name="dataProvider">qzBmCdglController#getCurrentDeptById</Property>
        <Property name="parameter">$${this.id_}</Property>
      </Reference>
      <Reference name="user">
        <Property name="dataType">[userType]</Property>
        <Property name="parameter">$${this.id_}</Property>
        <Property name="dataProvider">yxtkglController#getUserByDeptId</Property>
      </Reference>
    </DataType>
    <DataType name="userType">
      <Property name="creationType">gov.hygs.htgl.entity.User</Property>
      <PropertyDef name="id_">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
      <PropertyDef name="user_Name">
        <Property></Property>
        <Property name="label">录入人</Property>
      </PropertyDef>
    </DataType>
    <DataType name="resultType">
      <PropertyDef name="deptname">
        <Property name="label">部门</Property>
      </PropertyDef>
      <PropertyDef name="username">
        <Property name="label">用户名</Property>
      </PropertyDef>
      <PropertyDef name="cou">
        <Property name="label">贡献统计</Property>
      </PropertyDef>
      <PropertyDef name="tmname">
        <Property name="label">题目名称</Property>
      </PropertyDef>
      <PropertyDef name="laudCount">
        <Property name="label">题目点赞统计</Property>
      </PropertyDef>
    </DataType>
    <DataType name="conditionType">
      <PropertyDef name="type">
        <ClientEvent name="onSet">if(view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).get(&quot;type&quot;) != undefined){&#xD;
	view.get(&quot;#dsResult&quot;).getData().clear();&#xD;
	view.get(&quot;#dsScore&quot;).getData().clear();&#xD;
}&#xD;
if(arg.value &lt; 7){&#xD;
	view.get(&quot;#countGrid&quot;).set(&quot;visible&quot;,true);&#xD;
	view.get(&quot;#scoreGrid&quot;).set(&quot;visible&quot;,false);&#xD;
	if(arg.value == 6){&#xD;
		view.get(&quot;#dept&quot;).set(&quot;readOnly&quot;,true);&#xD;
		view.get(&quot;#tm&quot;).set(&quot;visible&quot;,true);&#xD;
		view.get(&quot;#laud&quot;).set(&quot;visible&quot;,true);&#xD;
		view.get(&quot;#deptName&quot;).set(&quot;visible&quot;,false);&#xD;
		view.get(&quot;#userName&quot;).set(&quot;visible&quot;,false);&#xD;
		view.get(&quot;#count&quot;).set(&quot;visible&quot;,false);&#xD;
	}else{&#xD;
		view.get(&quot;#dept&quot;).set(&quot;readOnly&quot;,false);&#xD;
		view.get(&quot;#tm&quot;).set(&quot;visible&quot;,false);&#xD;
		view.get(&quot;#laud&quot;).set(&quot;visible&quot;,false);&#xD;
		view.get(&quot;#deptName&quot;).set(&quot;visible&quot;,true);&#xD;
		view.get(&quot;#userName&quot;).set(&quot;visible&quot;,true);&#xD;
		view.get(&quot;#count&quot;).set(&quot;visible&quot;,true);&#xD;
	}&#xD;
	if(arg.value == 0 || arg.value == 2 || arg.value == 4 || arg.value == 6){&#xD;
		view.get(&quot;#userName&quot;).set(&quot;visible&quot;,false);&#xD;
		view.get(&quot;#user&quot;).set(&quot;readOnly&quot;,true);&#xD;
	}else{&#xD;
		view.get(&quot;#userName&quot;).set(&quot;visible&quot;,true);&#xD;
		view.get(&quot;#user&quot;).set(&quot;readOnly&quot;,false);&#xD;
	}&#xD;
	if(arg.value > 3){&#xD;
		view.get(&quot;#begin&quot;).set(&quot;visible&quot;,false);&#xD;
		view.get(&quot;#end&quot;).set(&quot;visible&quot;,false);&#xD;
	}else{&#xD;
		view.get(&quot;#begin&quot;).set(&quot;visible&quot;,true);&#xD;
		view.get(&quot;#end&quot;).set(&quot;visible&quot;,true);&#xD;
	}	&#xD;
}else{&#xD;
	view.get(&quot;#countGrid&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#scoreGrid&quot;).set(&quot;visible&quot;,true);&#xD;
	view.get(&quot;#begin&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#end&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#dept&quot;).set(&quot;readOnly&quot;,true);&#xD;
	view.get(&quot;#user&quot;).set(&quot;readOnly&quot;,false);&#xD;
	view.get(&quot;#answerCount&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#answerScore&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#rushAnswerScore&quot;).set(&quot;visible&quot;,false);&#xD;
	view.get(&quot;#examScore&quot;).set(&quot;visible&quot;,false);&#xD;
	if(arg.value == 7){&#xD;
		view.get(&quot;#answerCount&quot;).set(&quot;visible&quot;,true);&#xD;
	}&#xD;
	if(arg.value == 8){&#xD;
		view.get(&quot;#answerScore&quot;).set(&quot;visible&quot;,true);&#xD;
	}&#xD;
	if(arg.value == 9){&#xD;
		view.get(&quot;#rushAnswerScore&quot;).set(&quot;visible&quot;,true);&#xD;
	}&#xD;
	if(arg.value == 10){&#xD;
		view.get(&quot;#examScore&quot;).set(&quot;visible&quot;,true);&#xD;
	}&#xD;
}&#xD;
&#xD;
&#xD;
</ClientEvent>
        <Property name="label">统计类型</Property>
        <Property name="mapping">
          <Property name="mapValues">
            <Collection>
              <Entity>
                <Property name="key">0</Property>
                <Property name="value">部门出题贡献值</Property>
              </Entity>
              <Entity>
                <Property name="key">1</Property>
                <Property name="value">个人出题贡献值</Property>
              </Entity>
              <Entity>
                <Property name="key">2</Property>
                <Property name="value">部门知识要点贡献值</Property>
              </Entity>
              <Entity>
                <Property name="key">3</Property>
                <Property name="value">个人知识要点贡献值</Property>
              </Entity>
              <Entity>
                <Property name="key">4</Property>
                <Property name="value">部门被点赞数</Property>
              </Entity>
              <Entity>
                <Property name="key">5</Property>
                <Property name="value">个人被点赞数</Property>
              </Entity>
              <Entity>
                <Property name="key">6</Property>
                <Property name="value">题目被点赞数</Property>
              </Entity>
              <Entity>
                <Property name="key">7</Property>
                <Property name="value">用户答题数量</Property>
              </Entity>
              <Entity>
                <Property name="key">8</Property>
                <Property name="value">用户答题得分</Property>
              </Entity>
              <Entity>
                <Property name="key">9</Property>
                <Property name="value">用户抢答答题得分</Property>
              </Entity>
              <Entity>
                <Property name="key">10</Property>
                <Property name="value">用户考试分数</Property>
              </Entity>
            </Collection>
          </Property>
        </Property>
      </PropertyDef>
      <PropertyDef name="begin">
        <Property name="dataType">Date</Property>
        <Property name="label">起始时间</Property>
      </PropertyDef>
      <PropertyDef name="end">
        <Property name="dataType">Date</Property>
        <Property name="label">终止时间</Property>
      </PropertyDef>
      <PropertyDef name="dept">
        <Property name="label">部门名称</Property>
      </PropertyDef>
      <PropertyDef name="user">
        <Property name="label">用户名</Property>
      </PropertyDef>
      <PropertyDef name="content">
        <Property name="label">来源</Property>
      </PropertyDef>
      <PropertyDef name="deptid"/>
      <PropertyDef name="userid"/>
    </DataType>
    <DataType name="scoreType">
      <PropertyDef name="dept">
        <Property name="label">部门</Property>
      </PropertyDef>
      <PropertyDef name="user">
        <Property name="label">用户名</Property>
      </PropertyDef>
      <PropertyDef name="answerCount">
        <Property name="label">答题数量</Property>
      </PropertyDef>
      <PropertyDef name="answerScore">
        <Property name="label">答题得分</Property>
      </PropertyDef>
      <PropertyDef name="rushAnswerScore">
        <Property name="label">答题抢答答案得分</Property>
      </PropertyDef>
      <PropertyDef name="examScore">
        <Property name="label">考试分数</Property>
      </PropertyDef>
    </DataType>
  </Model>
  <View>
    <Container id="datasets">
      <DataSet id="dsDept">
        <Property name="dataType">[deptType]</Property>
        <Property name="dataProvider">qzBmCdglController#getDeptRoot</Property>
      </DataSet>
      <DataSet id="dsUser">
        <Property name="dataProvider">yxtkglController#getUserByDeptId</Property>
        <Property name="dataType">[userType]</Property>
      </DataSet>
      <DataSet id="dsResult">
        <Property name="dataType">[resultType]</Property>
        <Property name="dataProvider">tjglController#countGxjl</Property>
      </DataSet>
      <DataSet id="dsScore">
        <Property name="dataType">[scoreType]</Property>
        <Property name="dataProvider">tjglController#countGxjl</Property>
      </DataSet>
    </Container>
    <Container id="dropDowns">
      <CustomDropDown id="conditionDropDown">
        <Property name="autoOpen">true</Property>
        <Property name="height">500</Property>
        <DataTree id="datatree">
          <ClientEvent name="onDataRowClick">var dropDown = dorado.widget.DropDown.findDropDown(self);&#xD;
var node = self.get(&quot;currentNode&quot;);&#xD;
var deptId = node.get(&quot;data&quot;).get(&quot;id_&quot;);&#xD;
dropDown.close(&#xD;
	node.get(&quot;data&quot;).get(&quot;dept_name&quot;)&#xD;
);&#xD;
view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).set({deptid:deptId});&#xD;
&#xD;
view.get(&quot;#userInfoName&quot;).set(&quot;readOnly&quot;,false);&#xD;
&#xD;
view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).set({userid:&quot;&quot;});&#xD;
&#xD;
var user = view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).set({&#xD;
	user: &quot;&quot;&#xD;
});&#xD;
</ClientEvent>
          <Property name="dataSet">dsDept</Property>
          <BindingConfigs>
            <BindingConfig>
              <Property name="childrenProperty">dept</Property>
              <Property name="name">dept_name</Property>
              <Property name="labelProperty">dept_name</Property>
              <Property name="recursive">true</Property>
            </BindingConfig>
          </BindingConfigs>
        </DataTree>
      </CustomDropDown>
      <DataSetDropDown id="dsConditionDropDown">
        <ClientEvent name="onClose">var user = view.get(&quot;#dsUser&quot;).getData(&quot;#&quot;);&#xD;
if(user != undefined){&#xD;
	view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).set({userid:user.get(&quot;id_&quot;)});&#xD;
}&#xD;
&#xD;
</ClientEvent>
        <ClientEvent name="beforeExecute">var deptId = view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).get(&quot;deptid&quot;);&#xD;
view.get(&quot;#dsUser&quot;).set(&quot;parameter&quot;,deptId);&#xD;
view.get(&quot;#dsUser&quot;).flush();&#xD;
</ClientEvent>
        <Property name="autoOpen">true</Property>
        <Property name="property">user_Name</Property>
        <Property name="height">500</Property>
        <Property name="dataSet">dsUser</Property>
      </DataSetDropDown>
      <CustomDropDown id="deptDropDown">
        <Property name="autoOpen">true</Property>
        <Property name="height">500</Property>
        <DataTree id="depttree">
          <ClientEvent name="onDataRowClick">var dropDown = dorado.widget.DropDown.findDropDown(self);&#xD;
var node = self.get(&quot;currentNode&quot;);&#xD;
var deptId = node.get(&quot;data&quot;).get(&quot;id_&quot;);&#xD;
dropDown.close(&#xD;
	node.get(&quot;data&quot;).get(&quot;dept_name&quot;)&#xD;
);&#xD;
view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).set({deptid:deptId});&#xD;
</ClientEvent>
          <Property name="dataSet">dsDept</Property>
          <BindingConfigs>
            <BindingConfig>
              <Property name="childrenProperty">dept</Property>
              <Property name="name">dept_name</Property>
              <Property name="labelProperty">dept_name</Property>
              <Property name="recursive">true</Property>
            </BindingConfig>
          </BindingConfigs>
        </DataTree>
      </CustomDropDown>
      <DataSetDropDown id="userDropDown">
        <ClientEvent name="onClose">var user = view.get(&quot;#dsUser&quot;).getData(&quot;#&quot;);&#xD;
if(user != undefined){&#xD;
	view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).set({userid:user.get(&quot;id_&quot;)});&#xD;
}&#xD;
&#xD;
</ClientEvent>
        <ClientEvent name="beforeExecute">//var deptId = view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).get(&quot;deptid&quot;);&#xD;
//view.get(&quot;#dsUser&quot;).set(&quot;parameter&quot;,deptId);&#xD;
view.get(&quot;#dsUser&quot;).set(&quot;parameter&quot;,&quot;0&quot;);&#xD;
view.get(&quot;#dsUser&quot;).flush();&#xD;
</ClientEvent>
        <Property name="autoOpen">true</Property>
        <Property name="property">user_Name</Property>
        <Property name="height">500</Property>
        <Property name="dataSet">dsUser</Property>
      </DataSetDropDown>
    </Container>
    <Container>
      <GroupBox>
        <Property name="caption">查询条件</Property>
        <Buttons/>
        <Children>
          <AutoForm id="conditionForm">
            <ClientEvent name="onReady">self.get(&quot;entity&quot;).set({type:&quot;0&quot;});&#xD;
</ClientEvent>
            <Property name="dataType">conditionType</Property>
            <Property name="createPrivateDataSet">true</Property>
            <AutoFormElement id="begin">
              <Property name="name">begin</Property>
              <Property name="property">begin</Property>
              <Property name="hideMode">display</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement id="end">
              <Property name="name">end</Property>
              <Property name="property">end</Property>
              <Property name="hideMode">display</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement id="dept">
              <Property name="name">dept</Property>
              <Property name="property">dept</Property>
              <Property name="trigger">deptDropDown</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement id="user">
              <Property name="name">user</Property>
              <Property name="property">user</Property>
              <Property name="trigger">userDropDown</Property>
              <Property name="hideMode">display</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">type</Property>
              <Property name="property">type</Property>
              <Editor/>
            </AutoFormElement>
            <Button>
              <ClientEvent name="onClick">var entity = view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;);&#xD;
var type = view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).get(&quot;type&quot;);&#xD;
var dept = entity.get(&quot;dept&quot;);&#xD;
var user = entity.get(&quot;user&quot;);&#xD;
var begin = entity.get(&quot;begin&quot;);&#xD;
var end = entity.get(&quot;end&quot;);&#xD;
if(end &lt; begin &amp;&amp; end != null){&#xD;
	throw new dorado.Exception(&quot;起始日期不能小于终止日期！&quot;);&#xD;
}&#xD;
if(dept == &quot;&quot; || dept == undefined){&#xD;
	view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).set({&#xD;
		dept:null,&#xD;
		deptid:null&#xD;
		//user:null,&#xD;
		//userid:null&#xD;
	});&#xD;
}&#xD;
if(user == &quot;&quot; || user == undefined){&#xD;
	view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;).set({&#xD;
		user:null,&#xD;
		userid:null&#xD;
	});&#xD;
}&#xD;
&#xD;
if(type &lt; 7){&#xD;
	view.get(&quot;#dsResult&quot;).set(&quot;parameter&quot;,view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;));&#xD;
	view.get(&quot;#dsResult&quot;).flush();&#xD;
}else{&#xD;
	view.get(&quot;#dsScore&quot;).set(&quot;parameter&quot;,view.get(&quot;#conditionForm&quot;).get(&quot;entity&quot;));&#xD;
	view.get(&quot;#dsScore&quot;).flush();&#xD;
}&#xD;
&#xD;
</ClientEvent>
              <Property name="caption">查找</Property>
              <Property name="icon">url(>skin>common/icons.gif) -20px -40px</Property>
            </Button>
          </AutoForm>
        </Children>
      </GroupBox>
      <GroupBox>
        <Property name="caption">统计</Property>
        <Buttons/>
        <Children>
          <DataGrid id="countGrid">
            <Property name="dataSet">dsResult</Property>
            <Property name="height">300</Property>
            <Property name="readOnly">true</Property>
            <Property name="hideMode">display</Property>
            <DataColumn id="userName" name="username">
              <Property name="property">username</Property>
            </DataColumn>
            <DataColumn id="deptName" name="deptname">
              <Property name="property">deptname</Property>
            </DataColumn>
            <DataColumn id="count" name="cou">
              <Property name="property">cou</Property>
            </DataColumn>
            <DataColumn id="tm" name="tmname">
              <Property name="property">tmname</Property>
            </DataColumn>
            <DataColumn id="laud" name="laudCount">
              <Property name="property">laudCount</Property>
            </DataColumn>
          </DataGrid>
          <DataGrid id="scoreGrid">
            <Property name="hideMode">display</Property>
            <Property name="dataSet">dsScore</Property>
            <Property name="readOnly">true</Property>
            <DataColumn name="dept">
              <Property name="property">dept</Property>
            </DataColumn>
            <DataColumn name="user">
              <Property name="property">user</Property>
            </DataColumn>
            <DataColumn id="answerCount" name="answerCount">
              <Property name="property">answerCount</Property>
            </DataColumn>
            <DataColumn id="answerScore" name="answerScore">
              <Property name="property">answerScore</Property>
            </DataColumn>
            <DataColumn id="rushAnswerScore" name="rushAnswerScore">
              <Property name="property">rushAnswerScore</Property>
            </DataColumn>
            <DataColumn id="examScore" name="examScore">
              <Property name="property">examScore</Property>
            </DataColumn>
          </DataGrid>
        </Children>
      </GroupBox>
    </Container>
  </View>
</ViewConfig>
